{% extends 'base.html' %}

{% block title %}Record Milk - Nyanyakwa Dairy Farm{% endblock %}

{% block content %}
<h2 style="text-align: center; color: #2e7d32;">🐄 Record Milk Production</h2>

<!-- 🔘 DATE SELECTOR FORM -->
<form method="GET" style="text-align: center; margin: 20px 0;">
    <label for="selected_date"><strong>Select Date:</strong></label>
    <input type="date" id="selected_date" name="date" value="{{ selected_date }}">
    <button type="submit">📅 Load</button>
</form>

<p style="text-align: center; font-size: 16px;">Current Recording Date: <strong>{{ selected_date }}</strong></p>

<div style="overflow-x: auto;">
<table border="1" style="width: 100%; border-collapse: collapse; text-align: center; background: white;">
    <thead style="background-color: #a5d6a7; color: black;">
        <tr>
            <th>Tag Number</th>
            <th>Name</th>
            <th>Session</th>
            <th>Milk (L)</th>
            <th>Notes</th>
            <th>Status</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        {% for cow in cattle_list %}
        <tr>
            <form method="POST" action="{{ url_for('milk.record_milk') }}?date={{ selected_date }}">
                {{ csrf_token() }}
                <input type="hidden" name="cattle_id" value="{{ cow.cattle_id }}">
                <input type="hidden" name="date" value="{{ selected_date }}">

                <td>{{ cow.tag_number }}</td>
                <td>{{ cow.name or 'Unnamed' }}</td>

                <td>
                    <select name="session" class="session-select" onchange="updateSession(this)">
                        <option value="morning">Morning</option>
                        <option value="mid_day">Mid-day</option>
                        <option value="evening">Evening</option>
                    </select>
                </td>

                <td>
                    <input type="number" step="0.01" name="milk_value" placeholder="Milk (L)" required style="width: 100px;">
                </td>

                <td>
                    <input type="text" name="notes" placeholder="Optional notes" style="width: 150px;">
                </td>

                <td>
                    {% set label = status_labels.get(cow.cattle_id, '⏳ No session yet') %}
                    {{ label }}
                </td>

                <td>
                    <button type="submit" style="padding: 4px 10px;">💾 Save</button>
                </td>
            </form>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>

<script>
    function updateSession(selectElement) {
        const session = selectElement.value;
        const row = selectElement.closest('tr');
        const milkInput = row.querySelector('input[name="milk_value"]');

        const placeholders = {
            morning: 'Morning Milk (L)',
            mid_day: 'Mid-day Milk (L)',
            evening: 'Evening Milk (L)'
        };

        milkInput.placeholder = placeholders[session];
    }

    // Initialize placeholder for each row on load
    document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".session-select").forEach(select => {
            updateSession(select);
        });
    });
</script>
{% endblock %}
