{% extends 'base.html' %}

{% block title %}Milk Records - Nyanyakwa Dairy{% endblock %}

{% block content %}
<h2 style="text-align:center; color: #2e7d32;">🥛 Milk Records</h2>

<!-- 🔎 FILTER FORM -->
<form method="POST" style="text-align: center; margin-bottom: 20px;">
    {{ csrf_token() }}
    <label for="cow_id"><strong>Select Cow:</strong></label>
    <select name="cow_id" style="margin-right: 10px;">
        <option value="">-- All Cows --</option>
        {% for cow in cows %}
            <option value="{{ cow['cattle_id'] }}">
                {{ cow['name'] }} ({{ cow['tag_number'] }})
            </option>
        {% endfor %}
    </select>

    <label for="date"><strong>Date:</strong></label>
    <input type="date" name="date" style="margin-right: 10px;">

    <button type="submit" style="padding: 5px 15px;">🔍 Filter</button>
</form>

{% if records %}
<!-- 📋 RECORDS TABLE -->
<div style="overflow-x: auto;">
<table border="1" style="width: 95%; margin: auto; border-collapse: collapse; background-color: #fff;">
    <thead>
        <tr style="background-color: #a5d6a7; text-align: center;">
            <th>ID</th>
            <th>Cow</th>
            <th>Date</th>
            <th>Morning (L)</th>
            <th>Midday (L)</th>
            <th>Evening (L)</th>
            <th><strong>Total (L)</strong></th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for record in records %}
        {% set morning = record['morning_milk'] or 0 %}
        {% set mid_day = record['mid_day_milk'] or 0 %}
        {% set evening = record['evening_milk'] or 0 %}
        {% set total = morning + mid_day + evening %}
        <tr style="text-align: center;">
            <td>{{ record['id'] }}</td>
            <td>{{ record['name'] }} ({{ record['tag_number'] }})</td>
            <td>{{ record['date'].strftime('%Y-%m-%d') }}</td>
            <td>{{ morning }}</td>
            <td>{{ mid_day }}</td>
            <td>{{ evening }}</td>
            <td><strong>{{ total }}</strong></td>
            <td>
                <a href="{{ url_for('milk.edit_milk_record', record_id=record['id']) }}">✏️ Edit</a> |
                <a href="{{ url_for('milk.delete_milk_record', record_id=record['id']) }}" onclick="return confirm('Are you sure you want to delete this record?');">🗑️ Delete</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>

<!-- 📊 SUMMARY SECTION -->
{% if totals %}
<div style="width: 95%; margin: 30px auto; text-align: center; background-color: #f1f8e9; padding: 15px; border-radius: 8px;">
    <h3 style="color: #2e7d32;">📊 Production Summary</h3>
    <p><strong>🗓️ Weekly Total:</strong> {{ totals['weekly_total'] }} Litres</p>
    <p><strong>📅 Monthly Total:</strong> {{ totals['monthly_total'] }} Litres</p>
</div>
{% endif %}

{% else %}
<p style="text-align:center; color:gray;">No milk records found for the selected criteria.</p>
{% endif %}
{% endblock %}
